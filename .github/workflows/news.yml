name: ë‰´ìŠ¤ í¬ë¡¤ë§
on:
  push:
    branches:
      - main
  schedule:
    # ë§¤ì¼ í•œêµ­ ì‹œê°„ ìì •(00:00)ê³¼ ì˜¤ì „ 8ì‹œ(08:00)ì— ìë™ ì‹¤í–‰
    # UTC ê¸°ì¤€: ìì • = 15:00 (ì „ë‚ ), ì˜¤ì „ 8ì‹œ = 23:00 (ì „ë‚ )
    - cron: "0 15 * * *"  # í•œêµ­ ì‹œê°„ ìì • (UTC 15:00)
    - cron: "0 23 * * *"  # í•œêµ­ ì‹œê°„ ì˜¤ì „ 8ì‹œ (UTC 23:00)
  workflow_dispatch:
    # ìˆ˜ë™ ì‹¤í–‰ ê°€ëŠ¥
permissions:
  contents: write
  
jobs:
  collect-news-data:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      - name: ì €ì¥ì†Œ ì²´í¬ì•„ì›ƒ
        uses: actions/checkout@v3
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          persist-credentials: true

      - name: Python í™˜ê²½ ì„¤ì •
        uses: actions/setup-python@v4
        with:
          python-version: "3.10"
          cache: "pip"

      - name: íŒ¨í‚¤ì§€ ì„¤ì¹˜
        run: |
          pip install --upgrade pip
          pip install requests beautifulsoup4 lxml

      - name: ë‰´ìŠ¤ ë°ì´í„° ìˆ˜ì§‘
        run: |
          python newdata.py

      - name: ìˆ˜ì§‘ëœ íŒŒì¼ í™•ì¸
        run: |
          echo "ğŸ“ data í´ë” ë‚´ìš©:"
          ls -lh data/ || echo "data í´ë”ê°€ ì—†ìŠµë‹ˆë‹¤."

      - name: Git ì„¤ì •
        run: |
          git config --global user.name "hanyong5"
          git config --global user.email "hanyong5@naver.com"

      - name: ë³€ê²½ì‚¬í•­ ì»¤ë°‹ ë° í‘¸ì‹œ
        run: |
          git add data/
          if git diff --staged --quiet; then
            echo "ë³€ê²½ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤."
          else
            CURRENT_DATE=$(date +'%Y-%m-%d %H:%M:%S')
            git commit -m "ğŸ“° ë‰´ìŠ¤ ìˆ˜ì§‘: ${CURRENT_DATE}"
            git push
            echo "âœ… ë°ì´í„°ê°€ ì„±ê³µì ìœ¼ë¡œ ì»¤ë°‹ë˜ê³  í‘¸ì‹œë˜ì—ˆìŠµë‹ˆë‹¤."
          fi
