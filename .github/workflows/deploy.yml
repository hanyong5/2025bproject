name: í•´ì™¸ì‹œì¥ ì§€ìˆ˜ ìë™ ìˆ˜ì§‘
on:
  push:
    branches:
      - main
  schedule:
    # ë§¤ì¼ í•œêµ­ ì‹œê°„ ì˜¤ì „ 9ì‹œ (UTC 0ì‹œ)ì— ìë™ ì‹¤í–‰
    - cron: "0 0 * * *"
  workflow_dispatch:
    # ìˆ˜ë™ ì‹¤í–‰ ê°€ëŠ¥

jobs:
  collect-market-data:
    runs-on: ubuntu-latest

    steps:
      - name: Python í™˜ê²½ ì„¤ì •
        uses: actions/setup-python@v4
        with:
          python-version: "3.10"
          cache: "pip"

      - name: íŒ¨í‚¤ì§€ ì„¤ì¹˜
        run: |
          pip install --upgrade pip
          pip install fastapi pandas requests beautifulsoup4 lxml python-dateutil

      - name: í•´ì™¸ì‹œì¥ ì§€ìˆ˜ ë°ì´í„° ìˆ˜ì§‘
        run: |
          collect_monthly_data.py

      - name: ìˆ˜ì§‘ëœ íŒŒì¼ í™•ì¸
        run: |
          echo "ğŸ“ data í´ë” ë‚´ìš©:"
          ls -lh data/

      - name: Git ì„¤ì •
        run: |
          git config --global user.name "hanyong5"
          git config --global user.email "hanyong5@naver.com"

      - name: ë³€ê²½ì‚¬í•­ ì»¤ë°‹ ë° í‘¸ì‹œ
        run: |
          git add data/
          if git diff --staged --quiet; then
            echo "ë³€ê²½ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤."
          else
            CURRENT_DATE=$(date +'%Y-%m-%d %H:%M:%S')
            git commit -m "ğŸ“Š í•´ì™¸ì‹œì¥ ì§€ìˆ˜ ë°ì´í„° ìˆ˜ì§‘: ${CURRENT_DATE}"
            git push
            echo "âœ… ë°ì´í„°ê°€ ì„±ê³µì ìœ¼ë¡œ ì»¤ë°‹ë˜ê³  í‘¸ì‹œë˜ì—ˆìŠµë‹ˆë‹¤."
          fi
